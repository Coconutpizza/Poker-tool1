<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pro Strategic Assistant</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --accent-poker: #3b82f6;
            --accent-bj: #10b981;
            --accent-bet: #f59e0b;
            --text-main: #f1f5f9;
            --red-suit: #ef4444;
            --btn-bg: #334155;
            --btn-active: #475569;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }
        
        /* NAVIGATION */
        nav {
            display: flex;
            height: 55px;
            background: #0f172a;
            border-bottom: 1px solid #334155;
            z-index: 10;
        }
        nav button {
            flex: 1;
            background: none;
            border: none;
            color: #64748b;
            font-size: 0.9rem;
            font-weight: 800;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        nav button.active {
            color: white;
            border-bottom: 3px solid white;
        }

        /* LAYOUT */
        .app-view {
            display: none;
            flex: 1;
            flex-direction: column;
            padding: 10px;
            overflow-y: auto;
            position: relative;
        }
        .app-view.active {
            display: flex;
        }

        /* STATS BOXES */
        .stats-panel {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 16px;
            margin-bottom: 10px;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            border: 1px solid #334155;
        }
        .row { display: flex; justify-content: space-between; align-items: baseline; }
        .big-stat {
            font-size: 2.8rem;
            font-weight: 800;
            margin: 0;
            line-height: 1;
        }
        .sub-stat { font-size: 0.85rem; color: #94a3b8; font-weight: 600; text-transform: uppercase; }
        
        /* RECOMMENDATION BUBBLE */
        .rec-bubble {
            background: #2563eb;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 1.1rem;
            display: inline-block;
            margin-top: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }
        .rec-hit { background: #22c55e; color: #000; }
        .rec-stand { background: #ef4444; }
        .rec-double { background: #eab308; color: #000; }
        .rec-split { background: #a855f7; }
        .rec-fold { background: #64748b; }

        /* BETTING MODE OVERLAY */
        .bet-unit {
            display: none;
            color: var(--accent-bet);
            font-weight: bold;
            font-size: 1.2rem;
        }
        .bet-active .bet-unit { display: inline; }

        /* INPUT GRIDS */
        .grid-keyboard {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 6px;
            margin-top: auto;
            padding-bottom: 5px;
        }
        .btn-key {
            background: var(--btn-bg);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 16px 0;
            font-size: 1.3rem;
            font-weight: 700;
            touch-action: manipulation;
            transition: background 0.1s;
        }
        .btn-key:active { background: var(--btn-active); transform: scale(0.98); }
        .red { color: var(--red-suit); }
        
        /* SETTINGS MODAL */
        #settings-panel {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(5px);
            z-index: 100;
            padding: 20px;
            display: none;
        }
        #settings-panel.open { display: block; }
        .setting-row {
            margin-bottom: 25px;
        }
        .setting-label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #ccc;
        }
        .toggle-group {
            display: flex;
            background: #334155;
            border-radius: 8px;
            padding: 2px;
        }
        .toggle-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            background: transparent;
            color: #94a3b8;
            font-weight: bold;
        }
        .toggle-btn.selected {
            background: #475569;
            color: white;
            border-radius: 6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        /* POKER CARDS */
        .card-slot {
            display: inline-block;
            width: 42px; height: 58px;
            background: #334155;
            border-radius: 6px;
            margin: 2px;
            line-height: 58px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            border: 1px solid #475569;
        }
        .filled-card { background: #f1f5f9; color: black; border: none; }
        .filled-card.red { color: #dc2626; }

    </style>
</head>
<body>

<nav>
    <button id="nav-poker" class="active" onclick="switchTab('poker')">Poker</button>
    <button id="nav-bj" onclick="switchTab('bj')">Blackjack</button>
    <button onclick="toggleSettings()">⚙️</button>
</nav>

<div id="settings-panel">
    <h2 style="margin-top:0">Configuration</h2>
    
    <div class="setting-row">
        <span class="setting-label">Betting Advice Mode</span>
        <div class="toggle-group" id="tog-bet">
            <div class="toggle-btn" onclick="setSetting('betMode', false)">OFF</div>
            <div class="toggle-btn selected" onclick="setSetting('betMode', true)">ON</div>
        </div>
        <small style="color:#64748b; display:block; margin-top:5px;">Shows recommended units based on True Count.</small>
    </div>

    <div class="setting-row">
        <span class="setting-label">Blackjack Decks (Shoe Size)</span>
        <div class="toggle-group" id="tog-deck">
            <div class="toggle-btn" onclick="setDeckCount(1)">1</div>
            <div class="toggle-btn" onclick="setDeckCount(2)">2</div>
            <div class="toggle-btn selected" onclick="setDeckCount(6)">6</div>
            <div class="toggle-btn" onclick="setDeckCount(8)">8</div>
        </div>
    </div>

    <button class="btn-key" style="width:100%; background:var(--accent-poker); margin-top:20px;" onclick="toggleSettings()">DONE</button>
</div>

<div id="view-poker" class="app-view active">
    <div class="stats-panel">
        <div class="row">
            <div class="sub-stat">WIN EQUITY</div>
            <div class="sub-stat">VS 1 RND</div>
        </div>
        <div class="big-stat" id="poker-win-rate" style="color:var(--accent-poker)">--%</div>
        
        <div id="poker-rec" class="rec-bubble" style="display:none;">--</div>

        <div style="margin-top:15px;">
            <div id="my-cards" style="min-height:60px;">
                <span class="card-slot" style="opacity:0.3">H1</span>
                <span class="card-slot" style="opacity:0.3">H2</span>
            </div>
            <div id="board-cards" style="margin-top:5px; min-height:60px;"></div>
        </div>
    </div>

    <div style="flex:1;"></div>

    <div id="poker-msg" style="text-align:center; margin-bottom:10px; color:#64748b; font-weight:600;">SELECT RANK</div>

    <div id="poker-ranks" class="grid-keyboard">
        <button class="btn-key" onclick="pokerRank('A')">A</button>
        <button class="btn-key" onclick="pokerRank('K')">K</button>
        <button class="btn-key" onclick="pokerRank('Q')">Q</button>
        <button class="btn-key" onclick="pokerRank('J')">J</button>
        <button class="btn-key" onclick="pokerRank('T')">10</button>
        <button class="btn-key" onclick="pokerRank('9')">9</button>
        <button class="btn-key" onclick="pokerRank('8')">8</button>
        <button class="btn-key" onclick="pokerRank('7')">7</button>
        <button class="btn-key" onclick="pokerRank('6')">6</button>
        <button class="btn-key" onclick="pokerRank('5')">5</button>
        <button class="btn-key" onclick="pokerRank('4')">4</button>
        <button class="btn-key" onclick="pokerRank('3')">3</button>
        <button class="btn-key" onclick="pokerRank('2')">2</button>
        <button class="btn-key" style="grid-column: span 3; color: #ef4444; background:#1e1e1e" onclick="resetPoker()">CLEAR HAND</button>
    </div>

    <div id="poker-suits" class="grid-keyboard" style="display:none;">
        <button class="btn-key red" onclick="pokerSuit('h')" style="font-size:2rem">♥</button>
        <button class="btn-key red" onclick="pokerSuit('d')" style="font-size:2rem">♦</button>
        <button class="btn-key" onclick="pokerSuit('c')" style="font-size:2rem">♣</button>
        <button class="btn-key" onclick="pokerSuit('s')" style="font-size:2rem">♠</button>
        <button class="btn-key" style="grid-column: span 4; background:#1e1e1e; color:#94a3b8" onclick="cancelCard()">CANCEL</button>
    </div>
</div>

<div id="view-bj" class="app-view">
    <div class="stats-panel bet-active">
        <div class="row">
            <div class="sub-stat">TRUE COUNT</div>
            <div class="sub-stat">RUNNING: <span id="bj-running" style="color:white">0</span></div>
        </div>
        <div class="big-stat" id="bj-true">0.0</div>
        
        <div style="margin-top:10px; display:flex; justify-content:center; align-items:center; gap:10px;">
            <div id="bj-move" class="rec-bubble" style="background:#334155; font-size:1rem;">WAITING...</div>
            <div id="bj-bet-box" class="bet-unit">
                 BET: <span id="bj-bet-amt">1u</span>
            </div>
        </div>
        <div class="sub-stat" style="margin-top:8px;">DECKS LEFT: <span id="bj-decks">6.0</span></div>
    </div>
    
    <div style="flex:1; display:flex; flex-direction:column; justify-content:center; padding:0 20px;">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <div style="flex:1; background:#334155; padding:10px; border-radius:8px; text-align:center;">
                <div class="sub-stat" style="margin-bottom:5px;">DEALER UP</div>
                <div id="dealer-card-display" style="font-size:1.5rem; font-weight:bold; color:#64748b">?</div>
            </div>
            <div style="flex:1; background:#334155; padding:10px; border-radius:8px; text-align:center;">
                <div class="sub-stat" style="margin-bottom:5px;">MY TOTAL</div>
                <div id="player-total-display" style="font-size:1.5rem; font-weight:bold; color:#64748b">?</div>
            </div>
        </div>
        <div style="text-align:center; color:#64748b; font-size:0.8rem;">Tap cards to count. Toggle 'My Hand' to set player total.</div>
    </div>

    <div class="grid-keyboard">
        <div style="grid-column: span 4; display:flex; gap:5px; margin-bottom:5px;">
            <button id="mode-count" class="btn-key" style="flex:1; font-size:0.9rem; padding:10px; background:var(--accent-bj)" onclick="setBjInputMode('count')">COUNT MODE</button>
            <button id="mode-deal" class="btn-key" style="flex:1; font-size:0.9rem; padding:10px; background:#334155" onclick="setBjInputMode('dealer')">SET DEALER</button>
            <button id="mode-play" class="btn-key" style="flex:1; font-size:0.9rem; padding:10px; background:#334155" onclick="setBjInputMode('player')">SET PLAYER</button>
        </div>

        <button class="btn-key" onclick="bjInput(2, 1)">2</button>
        <button class="btn-key" onclick="bjInput(3, 1)">3</button>
        <button class="btn-key" onclick="bjInput(4, 1)">4</button>
        <button class="btn-key" onclick="bjInput(5, 1)">5</button>
        
        <button class="btn-key" onclick="bjInput(6, 1)">6</button>
        <button class="btn-key" onclick="bjInput(7, 0)">7</button>
        <button class="btn-key" onclick="bjInput(8, 0)">8</button>
        <button class="btn-key" onclick="bjInput(9, 0)">9</button>
        
        <button class="btn-key" onclick="bjInput(10, -1)">10/J</button>
        <button class="btn-key" onclick="bjInput(10, -1)">Q/K</button>
        <button class="btn-key" onclick="bjInput(11, -1)">A</button> <button class="btn-key" style="color:#ef4444; background:#1e1e1e" onclick="resetBjShoe()">RESET</button>
    </div>
</div>

<script>
    // --- APP STATE & SETTINGS ---
    let settings = {
        betMode: true,
        bjDecks: 6
    };

    function toggleSettings() {
        document.getElementById('settings-panel').classList.toggle('open');
    }

    function setSetting(key, val) {
        settings[key] = val;
        // Update UI toggles
        const parent = document.getElementById(key === 'betMode' ? 'tog-bet' : '');
        if(key === 'betMode') {
           document.querySelector('.stats-panel.bet-active').style.display = 'block'; // force refresh
           updateBjUI(); 
        }
        
        // Visual toggle update
        let btns = document.querySelectorAll(`#tog-${key === 'betMode' ? 'bet' : 'deck'} .toggle-btn`);
        btns.forEach(b => b.classList.remove('selected'));
        event.target.classList.add('selected');
    }

    function setDeckCount(n) {
        settings.bjDecks = n;
        // Update visuals
        let btns = document.querySelectorAll('#tog-deck .toggle-btn');
        btns.forEach(b => b.classList.remove('selected'));
        event.target.classList.add('selected');
        
        // Reset count on deck change
        resetBjShoe();
    }

    function switchTab(tab) {
        document.querySelectorAll('.app-view').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + tab).classList.add('active');
        document.getElementById('nav-' + tab).classList.add('active');
    }

    // --- BLACKJACK ENGINE ---
    let bjState = {
        running: 0,
        dealt: 0,
        inputMode: 'count', // 'count', 'dealer', 'player'
        dealerVal: null,
        playerVal: 0,
        isSoft: false,
        isPair: false // simplified input prevents perfect pair tracking, will use total
    };

    function setBjInputMode(mode) {
        bjState.inputMode = mode;
        // Reset temp values if switching to inputs
        if(mode === 'player') { bjState.playerVal = 0; bjState.isSoft = false; }
        if(mode === 'dealer') { bjState.dealerVal = null; }
        
        // Update Buttons
        document.getElementById('mode-count').style.background = mode === 'count' ? 'var(--accent-bj)' : '#334155';
        document.getElementById('mode-deal').style.background = mode === 'dealer' ? 'var(--accent-bj)' : '#334155';
        document.getElementById('mode-play').style.background = mode === 'player' ? 'var(--accent-bj)' : '#334155';
        
        // If switching back to count, clear the display for next hand
        if(mode === 'count') {
             // Optional: Auto clear hand after counting? No, keep it manual.
        }
    }

    function bjInput(cardVal, countVal) {
        // 1. Update Count (ALWAYS happens unless we are just setting up hand without counting? No, usually you count everything you see)
        // For this app: "Set Dealer" and "Set Player" are specific for the Recommendation Engine. 
        // We will assume if you are in those modes, you are inputting SPECIFIC cards for the hand.
        
        // Update Hi-Lo
        bjState.running += countVal;
        bjState.dealt++;
        
        // Handle Hand Logic
        if(bjState.inputMode === 'dealer') {
            bjState.dealerVal = cardVal;
            setBjInputMode('count'); // Jump back to count after setting dealer (only 1 card usually visible)
        } 
        else if(bjState.inputMode === 'player') {
            if(cardVal === 11) bjState.isSoft = true; // Ace
            bjState.playerVal += (cardVal === 11 ? 1 : cardVal); // Add as 1 first
            
            // Logic to handle Soft totals correctly
            if(bjState.isSoft && bjState.playerVal <= 11) {
                // It remains soft (e.g. A + 5 = 6 (soft 16))
                // We display it as soft
            } else if (bjState.isSoft && bjState.playerVal > 11) {
               // Hard number now? No, A(1)+10 = 11... wait. 
               // Simplified: We assume user inputs A as 11.
            }
        }

        updateBjUI();
    }

    function resetBjShoe() {
        bjState.running = 0;
        bjState.dealt = 0;
        bjState.dealerVal = null;
        bjState.playerVal = 0;
        updateBjUI();
    }

    function updateBjUI() {
        // Calc True Count
        let decksRem = Math.max(1, settings.bjDecks - (bjState.dealt / 52));
        let trueCount = bjState.running / decksRem;
        let trueRounded = Math.round(trueCount * 10) / 10;
        
        // Basic Stats
        document.getElementById('bj-running').innerText = bjState.running;
        document.getElementById('bj-true').innerText = trueRounded.toFixed(1);
        document.getElementById('bj-decks').innerText = decksRem.toFixed(1);
        
        // Color Coding True Count
        let tcEl = document.getElementById('bj-true');
        if(trueCount >= 2) tcEl.style.color = '#22c55e'; // Green
        else if(trueCount <= -1) tcEl.style.color = '#ef4444'; // Red
        else tcEl.style.color = 'white';

        // Betting Advice
        let betBox = document.getElementById('bj-bet-box');
        if(settings.betMode) {
            betBox.style.display = 'block';
            let units = 1;
            if(trueCount >= 1.5) units = 2;
            if(trueCount >= 2.5) units = 4;
            if(trueCount >= 3.5) units = 8;
            if(trueCount >= 4.5) units = 12; // Cap aggressive scaling
            document.getElementById('bj-bet-amt').innerText = units + "u";
        } else {
            betBox.style.display = 'none';
        }

        // Display Hand Values
        let dDisplay = bjState.dealerVal ? (bjState.dealerVal === 11 ? 'A' : bjState.dealerVal) : '?';
        let pDisplay = bjState.playerVal > 0 ? bjState.playerVal : '?';
        if(bjState.isSoft && bjState.playerVal <= 10) pDisplay = "Soft " + (bjState.playerVal + 10);
        
        document.getElementById('dealer-card-display').innerText = dDisplay;
        document.getElementById('player-total-display').innerText = pDisplay;

        // RECOMMENDATION ENGINE (Basic Strategy)
        let recEl = document.getElementById('bj-move');
        if(!bjState.dealerVal || bjState.playerVal === 0) {
            recEl.innerText = "WAITING...";
            recEl.className = "rec-bubble";
            recEl.style.background = "#334155";
        } else {
            let advice = getBasicStrategy(bjState.playerVal, bjState.dealerVal, bjState.isSoft);
            recEl.innerText = advice;
            
            // Style
            recEl.className = "rec-bubble";
            if(advice.includes("HIT")) recEl.classList.add("rec-hit");
            if(advice.includes("STAND")) recEl.classList.add("rec-stand");
            if(advice.includes("DOUBLE")) recEl.classList.add("rec-double");
        }
    }

    function getBasicStrategy(player, dealer, soft) {
        // dealer is 2-11 (11=Ace)
        // player is raw sum (if soft, we add 10 for calculation)
        
        let pTotal = soft && player <= 11 ? player + 10 : player;
        
        if(soft && player <= 11) {
            // Soft Totals
            if(pTotal >= 19) return "STAND"; // Soft 19/20
            if(pTotal === 18) {
                // Soft 18
                if(dealer >= 9) return "HIT";
                if(dealer >= 2 && dealer <= 8) return "DOUBLE / S";
            }
            if(pTotal === 17) return (dealer >=3 && dealer <=6) ? "DOUBLE / H" : "HIT";
            if(pTotal === 16 || pTotal === 15) return (dealer >=4 && dealer <=6) ? "DOUBLE / H" : "HIT";
            if(pTotal === 14 || pTotal === 13) return (dealer >=5 && dealer <=6) ? "DOUBLE / H" : "HIT";
        }
        
        // Hard Totals
        if(pTotal >= 17) return "STAND";
        if(pTotal >= 13 && pTotal <= 16) {
            if(dealer >= 2 && dealer <= 6) return "STAND";
            return "HIT";
        }
        if(pTotal === 12) {
            if(dealer >= 4 && dealer <= 6) return "STAND";
            return "HIT";
        }
        if(pTotal === 11) return "DOUBLE / H";
        if(pTotal === 10) return (dealer >= 10) ? "HIT" : "DOUBLE / H";
        if(pTotal === 9) return (dealer >= 3 && dealer <= 6) ? "DOUBLE / H" : "HIT";
        
        return "HIT";
    }

    // --- POKER ENGINE ---
    let pokerState = { myHand: [], community: [], tempRank: null };

    function pokerRank(r) {
        if (pokerState.myHand.length == 2 && pokerState.community.length == 5) return;
        pokerState.tempRank = r;
        document.getElementById('poker-ranks').style.display = 'none';
        document.getElementById('poker-suits').style.display = 'grid';
        document.getElementById('poker-msg').innerText = `SUIT FOR ${r}?`;
    }

    function cancelCard() {
        pokerState.tempRank = null;
        document.getElementById('poker-suits').style.display = 'none';
        document.getElementById('poker-ranks').style.display = 'grid';
        document.getElementById('poker-msg').innerText = "SELECT RANK";
    }

    function pokerSuit(s) {
        let card = { rank: pokerState.tempRank, suit: s };
        if (pokerState.myHand.length < 2) pokerState.myHand.push(card);
        else if (pokerState.community.length < 5) pokerState.community.push(card);

        cancelCard();
        renderPoker();
        
        if (pokerState.myHand.length === 2) {
            getPreflopAdvice();
            runPokerSim();
        }
    }

    function resetPoker() {
        pokerState.myHand = [];
        pokerState.community = [];
        document.getElementById('poker-rec').style.display = 'none';
        document.getElementById('poker-win-rate').innerText = "--%";
        renderPoker();
    }

    function renderPoker() {
        let hHTML = pokerState.myHand.map(c => renderCard(c)).join(' ');
        let bHTML = pokerState.community.map(c => renderCard(c)).join(' ');
        
        if (pokerState.myHand.length < 2) hHTML += ` <span class="card-slot" style="border-style:dashed; opacity:0.5">?</span>`;
        
        document.getElementById('my-cards').innerHTML = hHTML;
        document.getElementById('board-cards').innerHTML = bHTML;
    }

    function renderCard(c) {
        let suitIcon = {'h':'♥','d':'♦','c':'♣','s':'♠'}[c.suit];
        let colorClass = (c.suit == 'h' || c.suit == 'd') ? 'red' : '';
        return `<span class="card-slot filled-card ${colorClass}">${c.rank}${suitIcon}</span>`;
    }

    // POKER ADVICE SYSTEM
    function getPreflopAdvice() {
        if(pokerState.community.length > 0) {
            document.getElementById('poker-rec').style.display = 'none';
            return;
        }

        let c1 = pokerState.myHand[0];
        let c2 = pokerState.myHand[1];
        
        // Convert to values
        let valMap = {'2':2,'3':3,'4':4,'5':5,'6':6,'7':7,'8':8,'9':9,'T':10,'J':11,'Q':12,'K':13,'A':14};
        let v1 = valMap[c1.rank], v2 = valMap[c2.rank];
        let suited = c1.suit === c2.suit;
        let high = Math.max(v1, v2);
        let low = Math.min(v1, v2);
        let pair = v1 === v2;

        let action = "FOLD";
        let color = "rec-fold";

        // Simplified Logic
        if(pair) {
            if(high >= 10) { action = "RAISE (Premium)"; color = "rec-double"; }
            else if(high >= 7) { action = "RAISE / CALL"; color = "rec-hit"; }
            else { action = "SET MINE / FOLD"; color = "rec-split"; }
        } else if (suited) {
            if(high === 14 && low >= 10) { action = "RAISE"; color = "rec-double"; } // AKs - ATs
            else if(high === 13 && low >= 11) { action = "RAISE"; color = "rec-hit"; } // KQs, KJs
            else if(high === 14) { action = "CALL (Nut Flush)"; color = "rec-hit"; } // A2s+
            else if(high - low === 1 && high >= 10) { action = "CALL / RAISE"; color = "rec-hit"; } // JTs, etc
            else { action = "FOLD / LIMP"; }
        } else {
            if(high === 14 && low >= 11) { action = "RAISE"; color = "rec-double"; } // AKo, AQo, AJo
            else if(high === 13 && low >= 12) { action = "CALL / RAISE"; color = "rec-hit"; } // KQo
            else { action = "FOLD"; }
        }

        let recEl = document.getElementById('poker-rec');
        recEl.innerText = action;
        recEl.className = "rec-bubble " + color;
        recEl.style.display = "inline-block";
    }

    // POKER SIMULATION (Condensed)
    function runPokerSim() {
        document.getElementById('poker-win-rate').innerText = "...";
        setTimeout(() => {
            let deck = [];
            const R = "23456789TJQKA", S = "hdcs";
            for(let r of R) for(let s of S) deck.push({rank:r, suit:s});
            
            // Remove known
            let known = [...pokerState.myHand, ...pokerState.community];
            deck = deck.filter(d => !known.some(k => k.rank == d.rank && k.suit == d.suit));
            
            let wins = 0, sims = 600;
            for(let i=0; i<sims; i++) {
                shuffle(deck);
                let needed = 5 - pokerState.community.length;
                let board = [...pokerState.community, ...deck.slice(0, needed)];
                let opp = deck.slice(needed, needed+2);
                if(evalHand(pokerState.myHand, board) > evalHand(opp, board)) wins++;
            }
            document.getElementById('poker-win-rate').innerText = ((wins/sims)*100).toFixed(0) + "%";
        }, 20);
    }
    
    function shuffle(arr) { for(let i=arr.length-1; i>0; i--) { const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]] = [arr[j],arr[i]]; } }
    
    // Tiny Evaluator
    function evalHand(h, b) {
        let cards = [...h, ...b], rCounts = {}, sCounts = {};
        let ranks = cards.map(c => "23456789TJQKA".indexOf(c.rank)).sort((x,y)=>y-x);
        let suits = cards.map(c => c.suit);
        ranks.forEach(r => rCounts[r] = (rCounts[r]||0)+1);
        suits.forEach(s => sCounts[s] = (sCounts[s]||0)+1);
        
        let flush = Object.values(sCounts).some(v=>v>=5);
        let straight = false; 
        let u = [...new Set(ranks)];
        for(let i=0; i<u.length-4; i++) if(u[i]-u[i+4]==4) straight=true;
        
        let counts = Object.values(rCounts).sort((a,b)=>b-a);
        let val = ranks[0];
        
        if(straight && flush) return 800+val;
        if(counts[0]===4) return 700+val;
        if(counts[0]===3 && counts[1]>=2) return 600+val;
        if(flush) return 500+val;
        if(straight) return 400+val;
        if(counts[0]===3) return 300+val;
        if(counts[0]===2 && counts[1]===2) return 200+val;
        if(counts[0]===2) return 100+val;
        return val;
    }

    // Init
    resetBjShoe();
</script>
</body>
</html>
